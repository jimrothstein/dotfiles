## ---------------------
#       i3 config file (v4) - my cozy setup!
# ---------------------
#  REF: https://wiki.archlinux.org/title/I3
#  REF: https://i3wm.org/docs/userguide.html for a complete reference!
#  REF CARD ! (in i3 docs)
#  VIDEO:  Chris Titus Tech
#  i3bar vs polybar (better control?) 
#
#  SUSPEND = put info into RAM, then low-power (sleep)
#  CLOSE LID = should trigger SUSPEND
#  HIBERNATE = put info on DISK, then power-off (shutdown?)
#
# CLI:
# i3
# i3lock, service, handles details
# i3-msg, 
# i3-status

# commands
# -  exec				runs 1st load only
# -  exec --no-startup-id  	# registers window?
# -  exec_always  		runs on reload as well.
#
# Do NOT put comments (#) on same line as a command **
# Mod4 is 'windows' key 
#
# ---------------------------------------
set $mod Mod4
set $myTerm wezterm
workspace_layout stacking   

# Ex:  mod+2 (move to firefox);  2nd mod+2 returns you workspace came from
workspace_auto_back_and_forth yes

#------------------------ include 
#include ~/dotfiles/i3/config_extra

# ------------------------  font
# font pango:monospace 8   
font pango:DejaVu Sans Mono 12

 # ------------------------ XDG autostart
# Start XDG autostart .desktop files using dex. dex uses .desktop files(?)
# SEE https://wiki.archlinux.org/index.php/XDG_Autostart
exec --no-startup-id dex --autostart --environment i3

# ----------------
#       Applets?
# ----------------
# GOAL:  lock laptop BEFORE SUSPEND
# xss-lock grabs a logind suspend ????; then  use i3lock to lock the
# screen before suspend. Use loginctl lock-session to lock your screen.
# LOCK laptop before SUSPEND
exec --no-startup-id \
     xss-lock --transfer-sleep-lock -- i3lock --nofork

# -----------------
# NetworkManager 
# -----------------
# manage wifi with nm-applet,  a desktop environment-independent system tray GUI.
exec --no-startup-id nm-applet

# -------------------------------------------
# Use pactl to adjust volume in PulseAudio.
# -------------------------------------------
set $refresh_i3status killall -SIGUSR1 i3status
bindsym XF86AudioRaiseVolume exec --no-startup-id pactl set-sink-volume @DEFAULT_SINK@ +10% && $refresh_i3status
bindsym XF86AudioLowerVolume exec --no-startup-id pactl set-sink-volume @DEFAULT_SINK@ -10% && $refresh_i3status
bindsym XF86AudioMute exec --no-startup-id pactl set-sink-mute @DEFAULT_SINK@ toggle && $refresh_i3status
bindsym XF86AudioMicMute exec --no-startup-id pactl set-source-mute @DEFAULT_SOURCE@ toggle && $refresh_i3status

# ---------------
#       Bindsym
# ---------------
# Use Mouse+$mod to drag floating windows to their wanted position
floating_modifier $mod

#  BASICS
# ----------------------------------
# start dmenu (a program launcher) (compare dmenu | rofi )
# ----------------------------------
bindsym $mod+d exec --no-startup-id dmenu_run

# reload config
bindsym $mod+Shift+c reload
# restart
bindsym $mod+Shift+r restart

# exit  (returns to lightdm login)
bindsym $mod+Shift+e exec "i3-nagbar -t warning -m 'You pressed the exit shortcut. Do you really want to exit i3? This will end your X session.' -b 'Yes, exit i3' 'i3-msg exit'"

# active workspace tab = red/pink
bindsym $mod+p title_window_icon on


#------------------------  navigation, SEE config_extra
# set variables for named workspaces   ---------------------
set $ws1 "1: Terminal"
set $ws2 "2: Emacs"
set $ws3 "3: Firefox"
set $ws4 "4: RStudio"
set $ws5 "5: Files"
set $ws6 "6: R"
set $ws7 "7: Terminal"
set $ws8 "8: Zotero"
set $ws9 "9: Slack"
set $ws10 "10: Browser"

# switch to workspace
bindsym $mod+1 workspace number $ws1
bindsym $mod+2 workspace number $ws2
bindsym $mod+3 workspace number $ws3
bindsym $mod+4 workspace number $ws4
bindsym $mod+5 workspace number $ws5
bindsym $mod+6 workspace number $ws6
bindsym $mod+7 workspace number $ws7
bindsym $mod+8 workspace number $ws8
bindsym $mod+9 workspace number $ws9
bindsym $mod+0 workspace number $ws10

# move focused container to workspace
bindsym $mod+Shift+1 move container to workspace number $ws1
bindsym $mod+Shift+2 move container to workspace number $ws2
bindsym $mod+Shift+3 move container to workspace number $ws3
bindsym $mod+Shift+4 move container to workspace number $ws4
bindsym $mod+Shift+5 move container to workspace number $ws5
bindsym $mod+Shift+6 move container to workspace number $ws6
bindsym $mod+Shift+7 move container to workspace number $ws7
bindsym $mod+Shift+8 move container to workspace number $ws8
bindsym $mod+Shift+9 move container to workspace number $ws9
bindsym $mod+Shift+0 move container to workspace number $ws10

# STARTUP apps ---- (exec_always runs on 1st startup AND after $mod Shift r)
# ------------------------  emacsclient - too confusing
# CLAIM:  launches emacsclient dameon and opens frame (see init.el)
#exec_always --no-startup-id i3-msg 'workspace $ws2; exec emacsclient -c -n -a""'



exec_always --no-startup-id i3-msg 'workspace $ws1; exec $myTerm'
exec_always --no-startup-id i3-msg 'workspace $ws2; exec emacs'
exec_always --no-startup-id i3-msg 'workspace $ws3; exec firefox'
exec_always --no-startup-id i3-msg 'workspace $ws4; exec rstudio'    # low-case r
exec_always --no-startup-id i3-msg 'workspace $ws8; exec zotero'

#exec --no-startup-id i3-msg 'workspace $ws9; exec slack'
# ------------------------  resize

# mode "resize" windows ------------------------  
#       step #1  $mod+r to enter mode "resize"
#
mode "resize" {
        # These bindings trigger as soon as you enter the resize mode
        bindsym j resize shrink width 10 px or 10 ppt
        bindsym k resize grow height 10 px or 10 ppt
        bindsym l resize shrink height 10 px or 10 ppt
        bindsym semicolon resize grow width 10 px or 10 ppt

        # same bindings, but for the arrow keys
        bindsym Left resize shrink width 10 px or 10 ppt
        bindsym Down resize grow height 10 px or 10 ppt
        bindsym Up resize shrink height 10 px or 10 ppt
        bindsym Right resize grow width 10 px or 10 ppt

        # back to normal: Enter or Escape or $mod+r
        bindsym Return mode "default"
        bindsym Escape mode "default"
        bindsym $mod+r mode "default"
}

# ------------------------ activate mode "resize"
bindsym $mod+r mode "resize"

# ------------------------- mode "mode_launcher"
set $mode_launcher Launch: [f]irefox [s]lack [e]macs [r]studio [z]otero [w]ezterm
mode "$mode_launcher" {
    bindsym f exec firefox
    bindsym s exec slack
    bindsym e exec emacs
    bindsym r exec rstudio
    bindsym z exec zotero
    bindsym w exec wezterm

    bindsym Escape mode "default"
    bindsym Return mode "default"
}
# -----		   active mode "mode_launcher"   
bindsym $mod+o mode "$mode_launcher"

## Assign applications to workspaces

# RULE, especially for badly behaved apps
# for_window [class="org.wezfurlong.wezterm"] move to workspace $ws1


# assign, assigns an application to workspace
#assign [class="org.wezfurlong.wezterm"] $ws1
assign [class="rstudio"] $ws4

#------------------------  i3bar

# experimental
# Start i3bar to display a workspace bar (plus the system information i3status
# finds out, if available)
bar {
    # from https://github.com/Tazeg/i3status
    #status_command exec /home/yelinaung/.config/i3status/mybar.sh
    #status_command exec ~/dotfiles/i3/i3status/mybar.sh

    #status_command i3status --config ~/.config/i3/i3status.conf
    status_command i3status
    colors {
        separator #000000

        ## colour of border, background, and text
        focused_workspace       #2f343f #bf616a #d8dee8
        active_workspace        #2f343f #2f343f #d8dee8
        inactive_workspace      #2f343f #2f343f #d8dee8
        urgent_workspace        #2f343f #ebcb8b #2f343f
    }
    #height 25
}


#------------------------  $mode_system

# TODO:   problems - fix later


#set $mode_system System | (a) resize | (c) reload,  [E]xit i3, (r) reboot,  (Shift+s) shutdown

mode "$mode_system" {

    #bindsym l exec --no-startup-id $Locker, mode "default"


    # return, exist i3, return to  lightdm screen
    #bindsym e exec --no-startup-id i3-msg exit, mode "default"        

    # warns, but return to lightdm screen
    #bindsym $mod+Shift+e exec "i3-nagbar -t warning -m 'You pressed the exit shortcut. Do you really want to exit i3? This will end your X session.' -b 'Yes, exit i3' 'i3-msg exit'"

    # reboots system 
    #bindsym r exec --no-startup-id systemctl reboot, mode "default"

    # to get to zsh prompt
    #bindsym $mod+Shift+r restart

   # close the current window
   #bindsym $mod+Shift+q 

    # pauses for 90 sec at pymouth screen (?), then shuts down
    bindsym Shift+s exec --no-startup-id systemctl poweroff -i, mode "default"


    # back to normal: Enter or Escape
    #bindsym Return mode "default"
    #bindsym Escape mode "default"
}

# activate $mode_sytstem
bindsym $mod+y mode "$mode_system"



